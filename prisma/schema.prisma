generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
  schemas   = ["park_connect"]
}

model dim_favorites {
  favorite_id        Int                 @id @default(autoincrement())
  user_id            Int?
  space_id           Int?
  added_date         DateTime?           @default(now()) @db.Timestamp(6)
  dim_parking_spaces dim_parking_spaces? @relation(fields: [space_id], references: [space_id], onDelete: NoAction, onUpdate: NoAction)
  dim_users          dim_users?          @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([user_id, space_id], map: "dim_favorites_user_space_unique")
  @@schema("park_connect")
}

model dim_parking_spaces {
  space_id            Int                 @id @default(autoincrement())
  title               String              @db.VarChar
  description         String
  space_type          String?             @db.VarChar
  is_instant_book     Boolean?
  has_cctv            Boolean?
  ev_charging         Boolean?
  access_instructions String?
  images              String?
  location_id         Int?
  pricing_id          Int?
  dim_favorites       dim_favorites[]
  dim_space_location  dim_space_location? @relation(fields: [location_id], references: [location_id], onDelete: NoAction, onUpdate: NoAction)
  dim_pricing_model   dim_pricing_model?  @relation(fields: [pricing_id], references: [pricing_id], onDelete: NoAction, onUpdate: NoAction)
  fact_availability   fact_availability[]

  @@schema("park_connect")
}

model dim_payout {
  payout_id             Int             @id @default(autoincrement())
  method                String?         @db.VarChar
  status                String?         @db.VarChar
  payout_date           DateTime?       @db.Timestamp(6)
  transaction_reference String?         @db.VarChar
  fact_bookings         fact_bookings[]

  @@schema("park_connect")
}

model dim_pricing_model {
  pricing_id         Int                  @id @default(autoincrement())
  hourly_rate        Decimal?             @db.Decimal
  daily_rate         Decimal?             @db.Decimal
  weekly_rate        Decimal?             @db.Decimal
  monthly_rate       Decimal?             @db.Decimal
  dim_parking_spaces dim_parking_spaces[]

  @@schema("park_connect")
}

model dim_reviews {
  review_id                                           Int             @id @default(autoincrement())
  booking_id                                          Int?
  reviewer_id                                         Int?
  reviewee_id                                         Int?
  review_type                                         String?         @db.VarChar
  rating                                              Int?
  review_date                                         DateTime?       @db.Timestamp(6)
  comments                                            String?
  dim_users_dim_reviews_reviewee_idTodim_users        dim_users?      @relation("dim_reviews_reviewee_idTodim_users", fields: [reviewee_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  dim_users_dim_reviews_reviewer_idTodim_users        dim_users?      @relation("dim_reviews_reviewer_idTodim_users", fields: [reviewer_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  fact_bookings_dim_reviews_booking_idTofact_bookings fact_bookings?  @relation("dim_reviews_booking_idTofact_bookings", fields: [booking_id], references: [booking_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_reviews_booking")
  fact_bookings_fact_bookings_review_idTodim_reviews  fact_bookings[] @relation("fact_bookings_review_idTodim_reviews")

  @@schema("park_connect")
}

model dim_space_location {
  location_id        Int                  @id @default(autoincrement())
  address            String?              @db.VarChar
  city               String?              @db.VarChar
  state              String?              @db.VarChar
  zip_code           String?              @db.VarChar
  latitude           Decimal?             @db.Decimal
  longitude          Decimal?             @db.Decimal
  dim_parking_spaces dim_parking_spaces[]

  @@schema("park_connect")
}

model dim_users {
  user_id                                        Int                 @id @default(autoincrement())
  email                                          String              @unique @db.VarChar
  full_name                                      String              @db.VarChar
  phone_number                                   String              @unique @db.VarChar
  date_of_birth                                  DateTime            @db.Date
  status                                         Int                 @db.SmallInt
  address                                        String              @db.VarChar
  city                                           String              @db.VarChar
  state                                          String              @db.VarChar
  zip_code                                       String              @db.VarChar
  password                                       String
  is_verified                                    Boolean?
  registration_date                              DateTime            @db.Timestamp(6)
  updated_at                                     DateTime?           @db.Timestamp(6)
  reset_token                                    String?
  reset_token_expiry                             DateTime?           @db.Timestamp(6)
  dim_favorites                                  dim_favorites[]
  dim_reviews_dim_reviews_reviewee_idTodim_users dim_reviews[]       @relation("dim_reviews_reviewee_idTodim_users")
  dim_reviews_dim_reviews_reviewer_idTodim_users dim_reviews[]       @relation("dim_reviews_reviewer_idTodim_users")
  dim_vehicle                                    dim_vehicle[]
  fact_availability                              fact_availability[]
  fact_bookings                                  fact_bookings[]

  @@schema("park_connect")
}

model dim_vehicle {
  vehicle_id    Int        @id @default(autoincrement())
  user_id       Int?
  license_plate String?    @db.VarChar
  make          String?    @db.VarChar
  model         String?    @db.VarChar
  year          Int?       @db.SmallInt
  color         String?    @db.VarChar
  vehicle_type  String?    @db.VarChar
  dim_users     dim_users? @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("park_connect")
}

model fact_availability {
  availability_id     Int                 @id @default(autoincrement())
  owner_id            Int?
  space_id            Int?
  available_start     DateTime?           @db.Timestamp(6)
  available_end       DateTime?           @db.Timestamp(6)
  is_available        Boolean?
  availability_reason String?             @db.VarChar
  created_at          DateTime?           @db.Timestamp(6)
  updated_at          DateTime?           @db.Timestamp(6)
  dim_users           dim_users?          @relation(fields: [owner_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  dim_parking_spaces  dim_parking_spaces? @relation(fields: [space_id], references: [space_id], onDelete: NoAction, onUpdate: NoAction)
  fact_bookings       fact_bookings[]

  @@schema("park_connect")
}

model fact_bookings {
  booking_id                                        Int                @id @default(autoincrement())
  availability_id                                   Int?
  driver_id                                         Int?
  payout_id                                         Int?
  review_id                                         Int?
  start_time                                        DateTime?          @db.Timestamp(6)
  end_time                                          DateTime?          @db.Timestamp(6)
  duration_hours                                    Decimal?           @db.Decimal
  total_amount                                      Decimal?           @db.Decimal
  service_fee                                       Decimal?           @db.Decimal
  owner_payout                                      Decimal?           @db.Decimal
  booking_status                                    String?            @db.VarChar
  payment_status                                    String?            @db.VarChar
  cancellation_reason                               String?
  dim_reviews_dim_reviews_booking_idTofact_bookings dim_reviews[]      @relation("dim_reviews_booking_idTofact_bookings")
  fact_availability                                 fact_availability? @relation(fields: [availability_id], references: [availability_id], onDelete: NoAction, onUpdate: NoAction)
  dim_users                                         dim_users?         @relation(fields: [driver_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  dim_payout                                        dim_payout?        @relation(fields: [payout_id], references: [payout_id], onDelete: NoAction, onUpdate: NoAction)
  dim_reviews_fact_bookings_review_idTodim_reviews  dim_reviews?       @relation("fact_bookings_review_idTodim_reviews", fields: [review_id], references: [review_id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("park_connect")
}
