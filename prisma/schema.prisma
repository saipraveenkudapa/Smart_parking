// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  directUrl         = env("DIRECT_URL")
  relationMode      = "prisma"
}

enum UserRole {
  RENTER
  HOST
  ADMIN
}

enum SpaceType {
  GARAGE
  DRIVEWAY
  CARPORT
  STREET
  LOT
}

enum VehicleSize {
  MOTORCYCLE
  STANDARD
  SUV
  TRUCK
}

enum PricingType {
  DAILY
  MONTHLY
}

enum BookingStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
  COMPLETED
}

model User {
  id                String    @id @default(cuid())
  email             String    @unique
  password          String
  fullName          String
  phoneNumber       String    @unique
  role              UserRole  @default(RENTER)
  emailVerified     Boolean   @default(false)
  resetToken        String?
  resetTokenExpiry  DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  // Relations
  listings          Listing[]
  bookings          Booking[]
  
  @@map("users")
}

model PendingUser {
  id                String    @id @default(cuid())
  email             String    @unique
  password          String
  fullName          String
  phoneNumber       String    @unique
  role              UserRole  @default(RENTER)
  verificationToken String
  tokenExpiry       DateTime
  createdAt         DateTime  @default(now())
  
  @@map("pending_users")
}

model Listing {
  id                String       @id @default(cuid())
  hostId            String
  host              User         @relation(fields: [hostId], references: [id], onDelete: Cascade)
  
  // Location
  address           String
  city              String
  state             String
  zipCode           String
  latitude          Float?
  longitude         Float?
  
  // Details
  title             String
  description       String       @db.Text
  spaceType         SpaceType
  vehicleSize       VehicleSize
  accessInstructions String      @db.Text
  
  // Security & Features
  isGated           Boolean      @default(false)
  hasCCTV           Boolean      @default(false)
  isCovered         Boolean      @default(false)
  hasEVCharging     Boolean      @default(false)
  
  // Pricing
  pricingType       PricingType  @default(MONTHLY)
  price             Float        @default(0)
  monthlyPrice      Float?
  securityDeposit   Float        @default(0)
  
  // Availability
  availableFrom     DateTime
  isActive          Boolean      @default(true)
  
  // Images (stored as JSON array of URLs)
  images            String[]
  
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  
  // Relations
  bookings          Booking[]
  
  @@index([city])
  @@index([spaceType])
  @@index([monthlyPrice])
  @@map("listings")
}

model Booking {
  id                String        @id @default(cuid())
  renterId          String
  renter            User          @relation(fields: [renterId], references: [id])
  listingId         String
  listing           Listing       @relation(fields: [listingId], references: [id])
  
  // Booking details
  startDate         DateTime
  endDate           DateTime?
  vehicleDetails    String
  
  // Pricing
  monthlyPrice      Float
  totalMonths       Int
  platformFee       Float
  totalAmount       Float
  
  // Payment
  status            BookingStatus @default(PENDING)
  paidAt            DateTime?
  
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  
  @@index([renterId])
  @@index([listingId])
  @@index([status])
  @@map("bookings")
}
